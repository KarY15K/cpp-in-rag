# 13.c++11的智能指针有哪些。weak_ptr的使用场景。什么情况下会产生循环引用

# 13.c++11的智能指针有哪些。weak_ptr的使用场景。什么情况下会产生循环引用


1. unique_ptr：独占所有权的智能指针，只有一个指向该内存的引用，并且当该指针超出作用域或被删除时会自动释放所管理的对象。不支持拷贝和赋值操作。
2. shared_ptr：多个共享所有权的智能指针，可以有多个指向同一块内存空间，由计数器来记录当前有多少个shared_ptr同时引用该对象。当最后一个shared_ptr超出作用域或被删除时才会释放所管理的对象。
3. weak_ptr：弱引用智能指针，不会增加所管理对象的引用计数。它通常与shared_ptr配合使用，可以检测是否存在循环依赖关系，并避免因循环引用导致的内存泄漏问题。



weak_ptr主要应用在解决循环引用问题上。当两个或多个类之间互相持有shared_ptr成员变量时（即形成了循环依赖），如果这些shared_ptr都是直接相互引用而没有使用weak_ptr进行中介，则可能导致内存泄漏，因为它们互相引用将永远不会使得对方的计数器为0从而无法释放资源。此时可以使用weak_ptr解决这个问题，在其中一个类中使用weak_ptr成员变量来引用另一个类的shared_ptr，从而使得循环依赖关系被打破。



产生循环引用的情况通常是由于两个或多个类之间互相持有shared_ptr成员变量，例如：



```plain
class A {
public:
    std::shared_ptr<B> b;
};

class B {
public:
    std::shared_ptr<A> a;
};
```



在这种情况下，如果a和b都是shared_ptr类型，并且互相持有对方的引用，则可能形成循环依赖。当a和b被销毁时，它们所管理的对象将无法释放，从而导致内存泄漏。



> 更新: 2024-04-19 15:30:08  
> 原文: <https://www.yuque.com/linuxer/gscfv1/3a364f5a7bb4bfb6f1655dfc50ef5c91>