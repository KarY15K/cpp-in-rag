# 02.智能指针，里面的计数器何时会改变

# 02.智能指针，里面的计数器何时会改变


智能指针将一个计数器与类指向的对象相关联，引用计数跟踪共有多少个类对象（shared_ptr对象？）共享同一指针。它的具体做法如下：



1、当创建类的新对象时，初始化指针，并将引用计数设置为1



2、当对象作为另一个对象的副本时，复制构造函数复制副本指针，并增加与指针相应的引用计数（加1）



3、使用赋值操作符对一个对象进行赋值时，处理复杂一点：



（赋值判断要先判断 是否是自己给自己赋值）



先使左操作数的指针的引用计数减1（为何减1：因为指针已经指向别的地方），如果减1后引用计数为0，则释放指针所指对象内存。



然后增加右操作数所指对象的引用计数（为何增加：因为此时做操作数指向对象即右操作数指向对象）。



析构函数：调用析构函数时，析构函数先使引用计数减1，如果减至0则delete对象。



> 更新: 2024-04-19 15:29:53  
> 原文: <https://www.yuque.com/linuxer/gscfv1/f691b0aa8bdf8ff7dc7e1be207670bc2>