# 03.为什么用小根堆实现定时器

# 03.为什么用小根堆实现定时器


使用小根堆实现定时器的主要原因是时间复杂度低，可以在 O(log n) 的时间内完成插入和删除操作。而且由于小根堆会自动将最小的元素排到堆顶，因此我们只需要取出堆顶元素即可获取最近的超时时间，无需遍历整个队列。



具体来说，在使用小根堆实现定时器时，每个定时任务都会被封装成一个 TimerNode 结构体，并按照超时时间从小到大加入到小根堆中。当系统调用 epoll 或 select 等 I/O 多路复用函数等待事件发生时，我们只需要取出当前最近超时时间的任务进行处理，并更新剩余任务的超时时间即可。如果有新任务需要添加，则将其封装成 TimerNode 插入到小根堆中即可。



使用小根堆实现定时器还有一个好处是可以很方便地支持对已存在的定时任务进行取消或修改。只需要找到对应的 TimerNode 并从小根堆中删除即可。这种方式比较高效并且易于管理。



> 更新: 2024-04-19 15:33:10  
> 原文: <https://www.yuque.com/linuxer/gscfv1/5687e2f16b9095f2593e19b682ca8bf4>