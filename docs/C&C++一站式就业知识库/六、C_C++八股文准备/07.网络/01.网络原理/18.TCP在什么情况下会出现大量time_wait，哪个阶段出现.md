# 18.TCP在什么情况下会出现大量time_wait，哪个阶段出现

# 18.TCP在什么情况下会出现大量time_wait，哪个阶段出现


我们首先要弄清楚TIME_WAIT状态是什么？TIME_WAIT状态是主动关闭TCP连接的一方（即先发起FIN包的一方），在发送完最后一个ACK包后进入的状态。系统需要在TIME_WAIT状态下等待2MSL（_maximum segment lifetime_ ）后才能释放连接（端口）。根据RFC 793 MSL是2分钟，一般的TCP实现有30秒、1分钟和2分钟不等。进入TIME_WAIT状态等待2MSL主要有两个目的：一方面是主动关闭连接的一方在对方没有收到最后一个ACK包时（这时对方还会重发FIN，收到两个FIN的时间间隔一定小于2MSL）有时间可以重发ACK包，另一方面处于TIME_WAIT的连接（IP和端口组合）不能重用，这样可以保证被重新分配的socket不会受到之前残留的延迟重发报文影响。



     由于主动关闭TCP连接的一方才会进入TIME_WAIT状态，一般情况服务器端不会出现TIME_WAIT状态，因为大多数情况都是客户端主动发起连接并主动关闭连接。但是某些服务如pop/smtp、ftp却是服务端收到客户端的QUIT命令后主动关闭连接，这就造成这类服务器上容易出现大量的TIME_WAIT状态的连接，而且并发量越大处于此种状态的连接越多。另外，对于被动关闭连接的服务在主动关闭客户端非法请求或清理长时间不活动的连接时（**这种情况很可能是客户端程序忘记关闭连接**）也会出现TIME_WAIT的状态。



> 更新: 2024-04-19 15:33:35  
> 原文: <https://www.yuque.com/linuxer/gscfv1/60bd5f8651f4b786e3e139c5207225d3>