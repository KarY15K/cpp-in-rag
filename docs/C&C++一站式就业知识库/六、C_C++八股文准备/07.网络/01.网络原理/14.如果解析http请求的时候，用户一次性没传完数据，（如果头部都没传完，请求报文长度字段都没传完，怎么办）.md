# 14.如果解析http请求的时候，用户一次性没传完数据，（如果头部都没传完，请求报文长度字段都没传完，怎么办）

# 14.如果解析http请求的时候，用户一次性没传完数据，（如果头部都没传完，请求报文长度字段都没传完，怎么办）


当用户一次性没有传完整个HTTP请求报文时，HTTP解析器可能会遇到以下情况：



1. 请求头部未传完：在等待请求头部的状态下，如果读取的数据不足以解析出完整的请求头部，则可以等待更多数据到达，直到能够解析出完整的请求头部为止。如果连接已经关闭或者超时，则可以返回一个错误或异常。
2. 请求体未传完（Content-Length）：在等待消息体的状态下，如果读取的数据不足以满足Content-Length指定的长度，则可以继续等待更多数据到达，并将其存储在缓冲区中。当读取到足够数量的字节后，就可以开始处理HTTP消息体。如果连接已经关闭或者超时，则可以返回一个错误或异常。
3. 请求体未传完（Transfer-Encoding）：在等待消息体的状态下，如果使用了Transfer-Encoding进行编码，则需要根据当前编码类型和剩余数据量来判断是否需要等待更多数据。例如，在chunked编码中，每个块都有一个长度字段用于指示块大小，因此解析器可以依次读取每个块并将其存储在缓冲区中。当所有块都被读取完成后，解析器会跳转到processing complete状态并返回结果给调用者。



> 更新: 2024-04-19 15:33:29  
> 原文: <https://www.yuque.com/linuxer/gscfv1/be9b658faab86b7b1898d766da43efd5>