# 01.为什么要用epoll

# 01.为什么要用epoll


select不足  
1.select需要从用户态将监听的集合拷贝给内核，  
2.内核通过轮询的方式查找有事件的文件描述符并返回  
3.且文件描述符有上限  
4.没有直接告诉我们具体哪个fd有数据，导致需要遍历  
Epoll函数就是解决select的不足的  
从第一个函数看起int epoll_create(int size);  
创建epoll函数 返回一个epoll对象 这个epoll对象其实也是个文件描述符，但是这个文件描述符的本质其实是一个二叉树，平衡二叉树，也就是红黑树左子树和右子树高度差小于1.这个函数调用成功将在内核中发生。



第二个函数int epoll_ctl(int epfd, int op, int fd, struct epoll_event event);  
第一个参数epfd是那个红黑树文件描述符不必说了  
第二个参数Int op代表的是对这个对象的各种操作增删改查  
第三个参数指的是需要监听的套接字。  
第四个参数则是结构体的指针  
struct epoll_event  
{  
uint32_t events; / Epoll 事件 / 就是监听套接字的各种事件 读写连接等等  
epoll_data_t data; / 用户数据 */ IP端口等等  
};



等待返回函数int epoll_wait(int epid, struct epoll_event *events, int maxevents, int timeout);  
这个就是epoll最大的优势，当wait接收到响应的时候将把端口的信息放在event里面，int返回有几个信号，只要for循环一下int的次数，就可以将客户端的消息一次接收然后做出相应的应答，好用！。



> 更新: 2024-04-19 15:33:45  
> 原文: <https://www.yuque.com/linuxer/gscfv1/751dfde3424921c1b6f2213858456037>