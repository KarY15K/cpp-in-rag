# 05.select怎么用。底层原理

# 05.select怎么用。底层原理


select是一种I/O多路复用的机制，可以同时监视多个文件描述符的状态，当某个文件描述符就绪时，select会返回该文件描述符。其使用方法如下：



1. 创建一个fd_set类型的集合对象，并将要监听的所有文件描述符添加到集合中。
2. 调用select函数，等待其中任何一个文件描述符变为可读/可写/异常。
3. select函数返回后，遍历集合中所有文件描述符，判断哪些文件描述符发生了事件。
4. 处理发生事件的文件描述符。



底层原理：



在Linux系统中，select基于内核提供的轮询机制实现。当应用程序调用select函数时，它会将需要监听的所有文件描述符添加到内核维护的数据结构中（通常是一个位图或数组），然后进入阻塞状态等待。当有一个或多个文件描述符准备好时（即满足了指定条件：可读、可写或异常），内核会将这些已经就绪的事件返回给应用程序，并且清空之前存储在数据结构中对应位置上的位标记。此时应用程序可以通过遍历数据结构来确定哪些文件描述符处于就绪状态，并进行相应处理。



select存在以下缺点：



1. 监听数量受限：由于数据结构本身大小限制和系统资源限制等原因，在某些情况下select只能监听1024个文件描述符。
2. 每次调用都需要将所有待检查的fd集合从用户态拷贝到内核态，存在额外的系统调用和内存开销。
3. 无法高效地处理大量连接：当需要同时处理大量连接时，采用轮询机制会导致系统开销过大。



因此，在高性能、高并发的应用场景中，通常采用更为高效的I/O多路复用机制（如epoll）代替select。



> 更新: 2024-04-19 15:33:50  
> 原文: <https://www.yuque.com/linuxer/gscfv1/a78615c9e504a816fd06cc27589400bb>