# 21.你的项目死锁怎么检测的

# 21.你的项目死锁怎么检测的


如果程序出现死锁问题，可通过以下 3种方案中的任意一种进行分析和排查。  
方案一：jstack  
在使用 jstack 之前，我们需要先通过 jps -l得到运行程序的进程 ID，使用方法如下：



![1bdbc01163cf407fa50903258367e3d3.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439488-6a4425f7-7d19-46b6-8283-9d3517347688-249278.png)



有了进程 ID(PID)之后，我们就可以使用“jstack -l PID”来发现死锁问题了，如下图所示：



![1237043e31e64a9ba79c646fbfe757ff.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439699-98d5986a-4e2a-41c7-a2d1-8da0d021745f-718011.png)



方案二：jconsole  
jconsole工具位于jdk的bin目录下，如图：



![177b07ab82c44e3080ae3abf1e34a009.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439720-73093ae3-903c-46ec-a948-2d675910a548-649226.png)



双击进入，选择要调试的程序，如下图所示：



![27b5fd5a64844c598082090000da4d84.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439581-f1008b57-59b3-4103-868f-e35e9128acda-802676.png)



会出现如下提示，选择不安全的链接



![6972e5a1ace0478599d7d21a6d25e247.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439632-d9dcc206-4570-4f02-961b-8ffd37465450-559210.png)



点击线程栏目，然后点下面死锁，就会检测出来了



![844816cafa9b4d4a8c21258a56cf8b80.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439706-fd31d944-fa03-45f0-a803-da162619a619-022309.png)



方案三：jvisualvm  
jvisualvm 也在 JDK 的 bin 目录中，同样是双击打开：



![02e666a1fa904b3babdfd1af6aa6acef.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439593-595dc7b3-8946-4184-a45e-49da36ba64e3-782985.png)



点击线程栏目，如果发生死锁，会自动提示如下：



![a294448ba32c475fb57cbfd70ac3cf36.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439659-890fa329-4d6b-4943-9eb8-8402ef7b1408-142707.png)



点击线程dump:



![c1b208933e9d485fa498b76bcd78ce30.png](./img/44549646_Xt9Sk2YoZ0ZbbaCP/1724989439799-af46425b-f867-4137-8816-933d780905cb-181662.png)



以上是jdk8以上版本排查线程死锁的常用三种方案，还有一种是根据jmc（Oracle Java Mission Control ）排查，jmc是一个对 Java 程序进行管理、监控、概要分析和故障排查的工具套件，它也是在 JDK 的 bin 目录中。但是jdk1.8之后，jmc就已经不随着jdk一起发出去了，如果想要使用jmc对jvm进行监控，这时候需要手工下载jmc，然后在本地运行。oracle官网比较坑，现在只有jmc8.1版本下载，它需要jdk11,但作者暂时还没亲自试过，所以先不写了。



> 更新: 2024-04-19 15:34:26  
> 原文: <https://www.yuque.com/linuxer/gscfv1/43422eb9d31541ca12bd570de685b076>