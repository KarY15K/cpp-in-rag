# 04.GDB有哪些命令

# 04.GDB有哪些命令


## 1 启动gdb


### 1.1 运行时调试可执行程序


```plain
gdb
attach <pid>
```



或者



```plain
gdb attach <pid>
```



### 1.2 运行结束调试core文件


```plain
gdb <program> <core dump file>
```



## 2 gdb交互命令


### 2.1 运行


```plain
run (r)：		其作用是运行程序，当遇到断点后，程序会在断点处停止运行，等待用户输入下一步的命令。

continue (c)：	继续执行，到下一个断点处（或运行结束）

next (n)：		单步跟踪程序，当遇到函数调用时，也不进入此函数体；此命令同 step 的主要区别是，step 遇到用户自定义的函数，将步进到函数中去运行，而 next 则直接调用函数，不会进入到函数体内。

step (s)：		单步调试如果有函数调用，则进入函数；与命令n不同，n是不进入调用的函数的

until：			当你厌倦了在一个循环体内单步跟踪时，这个命令可以运行程序直到退出循环体。

until+line： 	运行至某行，不仅仅用来跳出循环

finish： 		运行程序，直到当前函数完成返回，并打印函数返回时的堆栈地址和返回值及参数值等信息。

call func(args)：调用程序中可见的函数，并传递“参数”，如：call gdb_test(55)

quit (q)：		退出gdb
```



### 2.2 断点


break/breakpoints 可以简写为b



```plain
break n :			在第n行处设置断点 //可以带上代码路径和代码名称： b xxx.cpp:578

b fn1 if a＞b：		条件断点设置

break func：		在函数func()的入口处设置断点，如：break cb_button

delete n：			删除第n个断点

disable n：			暂停第n个断点

enable n：			开启第n个断点

clear n：			清除第n行的断点

info breakpoints ：	显示当前程序的断点设置情况

delete breakpoints：清除所有断点
```



### 2.3 查看代码


```plain
list  (l)：	作用就是列出程序的源代码，默认每次显示10行，再次输入将接着上一次 list 命令的，输出下边的内容。

list line：	将显示当前文件以“行号”为中心的前后10行代码，如：list 12

list func：	将显示“函数名”所在函数的源代码，如：list main
```



### 2.4 打印


```plain
print 表达式 (p 表达式)：其中“表达式”可以是任何当前正在被测试程序的有效表达式，比如当前正在调试C语言的程序，那么“表达式”可以是任何C语言的有效表达式，包括数字，变量甚至是函数调用。

print a：				将显示 a 的值

print ++a：				将把 a 中的值加1,并显示出来

print gdb_test(a)：		将以变量 a 作为参数调用 gdb_test() 函数

display 表达式：			在单步运行时将非常有用，使用display命令设置一个表达式后，它将在每次单步进行指令后，紧接着输出被设置的表达式及值。如： display a

watch 表达式：			设置一个监视点，一旦被监视的“表达式”的值改变，gdb将强行终止正在被调试的程序。如： watch a

whatis ：				查询变量或函数

info function： 		查询函数

info locals： 			显示当前堆栈页的所有变量
```



**输出格式**  
一般来说，GDB会根据变量的类型输出变量的值。但你也可以自定义GDB的输出的格式。



```plain
x 按十六进制格式显示变量。
d 按十进制格式显示变量。
u 按十六进制格式显示无符号整型。
o 按八进制格式显示变量。
t 按二进制格式显示变量。
a 按十六进制格式显示变量。
c 按字符格式显示变量。
f 按浮点数格式显示变量。

p/format arg
```



### 2.5 查询


```plain
where/bt ：		当前运行的堆栈列表

bt backtrace ：	显示当前调用堆栈

up/down ：		改变堆栈显示的深度

set args 参数：	指定运行时的参数

show args：		查看设置好的参数

info program： 	来查看程序的是否在运行，进程号，被暂停的原因。
```



### 2.6 分割窗口


```plain
ayout：			用于分割窗口，可以一边查看代码，一边测试：

layout src：	显示源代码窗口

layout asm：	显示反汇编窗口

layout regs：	显示源代码/反汇编和CPU寄存器窗口

layout split：	显示源代码和反汇编窗口

Ctrl + L：		刷新窗口
```



### 2.7 变量和表达式


print和许多GDB的命令一样，可以接受一个表达式，GDB会根据当前的程序运行的数据来计算这个表达式，既然是表达式，那么就可以是当前程序运行中的const常量、变量、函数等内容。可惜的是GDB不能使用你在程序中所定义的宏。在表达式中，有几种GDB所支持的操作符：



```plain
@ ：	是一个和数组有关的操作符

:: ：	指定一个在文件或是一个函数中的变量
eg ：	p 'f2.c'::x

{} ：	表示一个指向内存地址的类型为type的一个对象
```



需要注意的是，如果你的程序编译时开启了优化选项，那么在用GDB调试被优化过的程序时，可能会发生某些变量不能访问，或是取值错误码的情况。这个是很正常的，因为优化程序会删改你的程序，整理你程序的语句顺序，剔除一些无意义的变量等，所以在GDB调试这种程序时，运行时的指令和你所编写指令就有不一样，也就会出现你所想象不到的结果。对付这种情况时，需要在编译程序时关闭编译优化。



### 2.8 数组


有时候，你需要查看一段连续的内存空间的值。比如数组的一段，或是动态分配的数据的大小。你可以使用GDB的“@”操作符，“@”的左边是第一个内存的地址的值，“@”的右边则你你想查看内存的长度。  
@的左边是数组的首地址的值，也就是变量array所指向的内容，右边则是数据的长度，其保存在变量len中，其输出结果，大约是下面这个样子的：



```plain
p array@len
$1 = {2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40}
```



### 2.9 查看内存


你可以使用examine命令（简写是x）来查看内存地址中的值  
n、f、u是可选的参数。  
n 是一个正整数，表示显示内存的长度，也就是说从当前地址向后显示几个地址的内容。  
f 表示显示的格式，参见上面。如果地址所指的是字符串，那么格式可以是s，如果地十是指令地址，那么格式可以是i。  
u 表示从当前地址往后请求的字节数，如果不指定的话，GDB默认是4个bytes。u参数可以用下面的字符来代替，b表示单字节，h表示双字节，w表示四字节，g表示八字节。当我们指定了字节长度后，GDB会从指内存定的内存地址开始，读写指定字节，并把其当作一个值取出来。



```plain
x/3uh 0x54320 ：表示，从内存地址0x54320读取内容，h表示以双字节为一个单位，3表示三个单位，u表示按十六进制显示。
```



### 2.10 自动显示


你可以设置一些自动显示的变量，当程序停住时，或是在你单步跟踪时，这些变量会自动显示。相关的GDB命令是display（disp）。



```plain
display/fmt expr
display/fmt $addr
//expr是一个表达式，fmt表示显示的格式，addr表示内存地址，当你用display设定好了一个或多个表达式后，只要你的程序被停下来，GDB会自动显示你所设置的这些表达式的值。
```



删除自动显示，dnums意为所设置好了的自动显式的编号。如果要同时删除几个，编号可以用空格分隔，如果要删除一个范围内的编号，可以用减号表示（如：2-5）。



```plain
undisplay dnums
delete display dnums
```



disable和enalbe不删除自动显示的设置，而只是让其失效和恢复。



```plain
disable display
enable display
```



查看display设置的自动显示的信息。GDB会打出一张表格，向你报告当然调试中设置了多少个自动显示设置，其中包括，设置的编号，表达式，是否enable。



```plain
info display
```



### 2.11 设置显示选项


GDB中关于显示的选项比较多，这里只例举大多数常用的选项。



```plain
set print address on/off ： 	开/关地址输出，当程序显示函数信息时，GDB会显出函数的参数地址，系统默认为打开的。
show print address ： 			查看当前地址显示选项是否打开

set print array on/off ： 		开/关数组显示，打开后当数组显示时，每个元素占一行，如果不打开的话，每个元素则以逗号分隔。这个选项默认是关闭的。
show print array： 				查看当前数组显示选项是否打开。

set print null-stop on/off：	如果打开了这个选项，那么当显示字符串时，遇到结束符则停止显示。这个选项默认为off。

set print pretty on/off：		如果打开printf pretty这个选项，那么当GDB显示结构体时会比较漂亮。

set print sevenbit-strings on/off：设置字符显示，是否按“\nnn”的格式显示，如果打开，则字符串或字符数据按\nnn显示，如“65”。

set print union on/off：		设置显示结构体时，是否显式其内的联合体数据。
```



eg：



```plain
typedef enum {Tree, Bug} Species;
typedef enum {Big_tree, Acorn, Seedling} Tree_forms;
typedef enum {Caterpillar, Cocoon, Butterfly}
Bug_forms;
struct thing {
  Species it;
  union {
    Tree_forms tree;
    Bug_forms bug;
  } form;
};
struct thing foo = {Tree, {Acorn}};
```



```plain
p foo
打开：$1 = {it = Tree, form = {tree = Acorn, bug = Cocoon}}
关闭：$1 = {it = Tree, form = {...}}

set print object on/off：		在C++中，如果一个对象指针指向其派生类，如果打开这个选项，GDB会自动按照虚方法调用的规则显示输出，如果关闭这个选项的话，GDB就不管虚函数表了。这个选项默认是off。

set print static-members on/off：这个选项表示，当显示一个C++对象中的内容是，是否显示其中的静态数据成员。默认是on。

set print vtbl on/off：			当此选项打开时，GDB将用比较规整的格式来显示虚函数表时。其默认是关闭的。
```



### 2.12 历史记录


当你用GDB的print查看程序运行时的数据时，你每一个print都会被GDB记录下来。GDB会以$1, $2, $3 …这样的方式为你每一个print命令编上号。于是，你可以使用这个编号访问以前的表达式，如$1。这个功能所带来的好处是，如果你先前输入了一个比较长的表达式，如果你还想查看这个表达式的值，你可以使用历史记录来访问，省去了重复输入。



### 2.13 自定义变量


你可以在GDB的调试环境中定义自己的变量，用来保存一些调试程序中的运行数据。要定义一个GDB的变量很简单只需。使用GDB的set命令。GDB的环境变量和UNIX一样，也是以$起头。



```plain
eg：set $foo = *object_ptr
show convenience：	查看当前所设置的所有的环境变量
```



### 2.14 查看寄存器


```plain
info registers：	查看寄存器的情况。（包括浮点寄存器）
info all-registers：查看寄存器的情况。（除了浮点寄存器）
```



## 3 离线调试


当你的用户只能给你提供一个coredump文件而没有实际运行环境的时候，你也可以自己搭建离线调试环境。  
需要准备好，同版本的所有coredump进程涉及到的二进制文件，包括动态链接库，编译出带gdb编译选项的版本，加载调试。  
同版本指的是完全没有代码变更，这样即使codedump文件使用release版本的软件生成的，也可以用带符号信息的debug版本的软件来调试，十分强大！  
gdb 进入gdb后，需要设置下本地的对应lib的搜索路径：



```plain
set solib-search-path lib1:lib2:libn
```



> 更新: 2024-04-19 15:31:42  
> 原文: <https://www.yuque.com/linuxer/gscfv1/760e79bd3dd79c7d49f5d9508e96e9ca>