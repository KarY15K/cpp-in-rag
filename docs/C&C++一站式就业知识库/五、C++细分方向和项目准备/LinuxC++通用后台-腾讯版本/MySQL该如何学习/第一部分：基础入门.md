# 第一部分：基础入门

# 1. 安装配置MySQL
## 1.1 Windows安装MySQL
1. 下载MySQL安装包：
    - 访问官网 [https://dev.mysql.com/downloads/installer/](https://dev.mysql.com/downloads/installer/)
    - 下载MySQL Installer
2. 安装步骤：
    - 运行安装程序，选择"Developer Default"
    - 设置root密码（务必记住）
    - 保留默认配置完成安装

## 1.2 Ubuntu 20.04 安装 **MySQL**
以下是在 **Ubuntu 20.04 LTS** 上安装 **MySQL** 的详细教程，包含安装、配置和基本操作：

### **步骤 1：更新系统包**
在安装前，确保系统包是最新的：

```bash
sudo apt update
sudo apt upgrade -y
```

---

### **步骤 2：安装 MySQL**
Ubuntu 20.04 默认提供 MySQL 8.0：

```bash
sudo apt install mysql-server -y
```

---

### **步骤 3：启动 MySQL 服务**
安装完成后，MySQL 会自动启动。检查状态：

```bash
sudo systemctl status mysql
```

如果未启动，手动启动：

```bash
sudo systemctl start mysql
sudo systemctl enable mysql  # 设置开机自启
```

---

### **步骤 4：运行安全配置脚本**
MySQL 提供了一个安全脚本，用于设置 root 密码、移除匿名用户等：

```bash
sudo mysql_secure_installation
```

按提示操作：

1. 选择密码强度（推荐选 `2`）。
2. 设置 root 密码。
3. 移除匿名用户？输入 `Y`。
4. 禁止 root 远程登录？输入 `Y`（按需选择）。
5. 移除测试数据库？输入 `Y`。
6. 重新加载权限表？输入 `Y`。

---

### **步骤 5：登录 MySQL**
使用 root 用户登录：

```bash
sudo mysql -u root -p
```

输入步骤 4 设置的密码。

---

### **步骤 6（可选）：配置远程访问**
如果需要远程连接 MySQL，需修改绑定地址和用户权限：

1. 编辑配置文件：

```bash
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
```

找到 `bind-address` 并改为：

```properties
bind-address = 0.0.0.0
```

2. 登录 MySQL，授权远程用户（例如允许用户 `root` 从任意 IP 访问）：

```sql
CREATE USER 'root'@'%' IDENTIFIED BY '你的密码';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
FLUSH PRIVILEGES;
```

3. 重启 MySQL 生效：

```bash
sudo systemctl restart mysql
```

> **注意**：开放远程访问需配置防火墙（如 `ufw`）允许端口 `3306`：
>

```bash
sudo ufw allow 3306
```

---

### **步骤 7：常用命令**
+ **停止/启动/重启 MySQL**：

```bash
sudo systemctl stop mysql
sudo systemctl start mysql
sudo systemctl restart mysql
```

+ **<font style="color:#DF2A3F;">卸载 MySQL(目前不需要卸载，这里只是给出来命令)</font>**<font style="color:#DF2A3F;">：</font>

```bash
sudo apt purge mysql-server mysql-client mysql-common -y
sudo rm -rf /etc/mysql /var/lib/mysql
sudo apt autoremove -y
```



### **可能遇到的问题****<font style="color:#DF2A3F;">(这里只是备用)</font>**
1. **忘记 root 密码**：
    - 编辑配置文件：

```bash
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
```

    - 在 `[mysqld]` 段添加：

```properties
skip-grant-tables
```

    - 重启 MySQL，无密码登录后修改密码：

```sql
ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码';
```

    - 最后移除 `skip-grant-tables` 并重启。
2. **连接错误 **`caching_sha2_password`：
    - MySQL 8.0 默认使用新身份验证插件，旧客户端可能不支持。修改用户密码为传统模式：

```sql
ALTER USER '用户名'@'主机' IDENTIFIED WITH mysql_native_password BY '密码';
```

---

完成！现在你的 Ubuntu 20.04 已成功安装并配置 MySQL。根据需求调整权限和网络设置即可。

## 验证安装
```plain
mysql -u root -p
输入密码
```

# 2. 创建数据库和表
## 创建数据库
```sql
-- 如果 myshop已经存就删除myshop
DROP DATABASE IF EXISTS myshop;

-- 创建一个新数据库
CREATE DATABASE myshop;

-- 查看所有数据库
SHOW DATABASES;

-- 使用指定数据库
USE myshop;
```

## 创建表（带字段注释）
```sql
-- 创建用户表（带详细字段注释）
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID，自增主键',
    username VARCHAR(50) NOT NULL COMMENT '用户名，登录账号，不可为空',
    password VARCHAR(100) NOT NULL COMMENT '用户密码，加密存储，不可为空',
    email VARCHAR(100) UNIQUE COMMENT '用户邮箱，唯一值，用于找回密码等操作',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '账户创建时间，自动设置为当前时间'
) COMMENT '用户信息表';

-- 查看所有表
SHOW TABLES;

-- 查看表结构（包含注释）
SHOW FULL COLUMNS FROM users;
```

# 3. 基本数据类型
## 数值类型
+ INT：整数
+ DECIMAL(m,n)：精确小数，m总位数，n小数位
+ FLOAT/DOUBLE：浮点数

## 字符串类型
+ CHAR(n)：固定长度
+ VARCHAR(n)：可变长度
+ TEXT：长文本

## 日期时间类型
+ DATE：日期(YYYY-MM-DD)
+ TIME：时间(HH:MM:SS)
+ DATETIME：日期时间
+ TIMESTAMP：时间戳

## 创建商品表示例（带字段注释）
```sql
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '商品ID，自增主键',
    name VARCHAR(100) NOT NULL COMMENT '商品名称，不可为空',
    price DECIMAL(10,2) NOT NULL COMMENT '商品售价，精确到分，不可为空',
    description TEXT COMMENT '商品详细描述，可存储长文本',
    stock INT DEFAULT 0 COMMENT '库存数量，默认为0',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '商品创建时间，自动设置为当前时间'
) COMMENT '商品信息表';
```

# 4. 增删改查（CRUD）操作
## 插入数据（CREATE）
```sql
-- 插入单条记录
INSERT INTO users (username, password, email) 
VALUES ('张三', '123456', 'zhangsan@example.com');

-- 插入多条记录
INSERT INTO users (username, password, email) 
VALUES 
    ('李四', '123456', 'lisi@example.com'),
    ('王五', '123456', 'wangwu@example.com');

-- 查看插入的数据
SELECT * FROM users;
```

## 查询数据（READ）
```sql
-- 查询所有列
SELECT * FROM users;

-- 查询特定列
SELECT username, email FROM users;

-- 条件查询
SELECT * FROM users WHERE username = '张三';
```

## 更新数据（UPDATE）
```sql
-- 更新一条记录
UPDATE users SET password = '654321' WHERE username = '张三';

-- 更新多条记录
UPDATE users SET password = '888888' WHERE id > 1;
```

## 删除数据（DELETE）
```sql
-- 删除特定记录
DELETE FROM users WHERE username = '王五';

-- 删除所有记录（危险操作）
-- DELETE FROM users;
```



# 5. 简单条件查询
首先，让我们先向产品表中插入一些数据：

```sql
-- 向products表插入测试数据
INSERT INTO products (name, price, description, stock) VALUES 
    ('手机壳', 39.90, '适用于多种型号手机的保护壳', 500),
    ('耳机', 129.00, '有线耳机，高音质', 300),
    ('充电器', 69.90, '22.5W快充', 400),
    ('手机支架', 29.90, '桌面手机支架', 600),
    ('蓝牙音箱', 199.90, '无线蓝牙音箱，防水', 200),
    ('平板电脑', 2399.00, '10.2英寸屏幕', 100),
    ('笔记本电脑', 5999.00, '轻薄本', 50),
    ('智能手表', 1299.00, '运动监测功能', 150),
    ('移动电源', 159.90, '10000mAh大容量', 250),
    ('键盘', 249.90, '机械键盘', 80);
```

现在我们有了数据，可以进行各种条件查询练习：

## 比较运算符
```sql
-- 等于、不等于
SELECT * FROM products WHERE price = 199.90;  -- 查找价格等于199.90的商品
SELECT * FROM products WHERE price != 199.90; -- 查找价格不等于199.90的商品

-- 大于、小于、大于等于、小于等于
SELECT * FROM products WHERE price > 200;     -- 查找价格大于200的商品
SELECT * FROM products WHERE price < 100;     -- 查找价格小于100的商品
SELECT * FROM products WHERE price >= 199.90; -- 查找价格大于等于199.90的商品
SELECT * FROM products WHERE price <= 69.90;  -- 查找价格小于等于69.90的商品
```

## 逻辑运算符
```sql
-- AND（与）：两个条件都满足
SELECT * FROM products WHERE price > 50 AND stock > 300;  -- 查找价格大于50且库存大于300的商品

-- OR（或）：满足任一条件
SELECT * FROM products WHERE price < 50 OR stock > 500;   -- 查找价格小于50或库存大于500的商品

-- NOT（非）：条件取反
SELECT * FROM products WHERE NOT price > 200;             -- 查找价格不大于200的商品
```

## 范围查询
```sql
-- BETWEEN：在指定范围内
SELECT * FROM products WHERE price BETWEEN 100 AND 200;   -- 查找价格在100到200之间的商品

-- IN：在指定集合内
SELECT * FROM products WHERE name IN ('手机壳', '耳机', '充电器');  -- 查找名称为手机壳、耳机或充电器的商品
```

## 模糊查询
```sql
-- LIKE：模糊匹配
SELECT * FROM products WHERE name LIKE '手机%';       -- 查找名称以"手机"开头的商品
SELECT * FROM products WHERE name LIKE '%电脑%';      -- 查找名称中包含"电脑"的商品
SELECT * FROM products WHERE description LIKE '%防水%'; -- 查找描述中包含"防水"的商品
```

## NULL值查询
```sql
-- 假设我们有些商品的描述是NULL
UPDATE products SET description = NULL WHERE id = 1;

-- IS NULL：查找为NULL的值
SELECT * FROM products WHERE description IS NULL;     -- 查找描述为NULL的商品

-- IS NOT NULL：查找不为NULL的值
SELECT * FROM products WHERE description IS NOT NULL; -- 查找描述不为NULL的商品
```

## 排序查询
```sql
-- ORDER BY：排序
SELECT * FROM products ORDER BY price;                -- 按价格升序排列
SELECT * FROM products ORDER BY price DESC;           -- 按价格降序排列
SELECT * FROM products ORDER BY stock DESC, price;    -- 先按库存降序，再按价格升序
```

## 限制结果数量
```sql
-- LIMIT：限制结果数量
SELECT * FROM products ORDER BY price DESC LIMIT 3;   -- 查找价格最高的3个商品
SELECT * FROM products LIMIT 4, 3;                    -- 查找第5到第8个商品（分页功能）
```

## 组合条件查询
```sql
-- 综合示例
SELECT name, price, stock FROM products 
WHERE price > 100 AND stock < 200 
ORDER BY price DESC 
LIMIT 5;                                              -- 查找价格大于100且库存小于200的商品，按价格降序排列，最多显示5条
```

这些查询示例展示了MySQL中最常用的简单条件查询操作。通过这些操作，你可以筛选、排序和限制数据，以便从数据库中获取所需的精确信息。在实际应用中，这些基本查询操作经常会组合使用，以满足复杂的业务需求。



# 6 实战练习：创建一个简单的电商数据库
## 创建数据库
```sql
DROP DATABASE IF EXISTS myshop;
CREATE DATABASE myshop;
USE myshop;
```



## 创建表
```sql
-- 创建用户表（带字段注释）
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID，自增主键',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名，不可重复，用于登录',
    password VARCHAR(100) NOT NULL COMMENT '用户密码，加密存储',
    email VARCHAR(100) UNIQUE COMMENT '用户邮箱，唯一标识',
    phone VARCHAR(20) COMMENT '用户手机号码',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '账号创建时间'
) COMMENT '用户信息表';

-- 创建商品表（带字段注释）
CREATE TABLE products (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '商品ID，自增主键',
    name VARCHAR(100) NOT NULL COMMENT '商品名称，不可为空',
    price DECIMAL(10,2) NOT NULL COMMENT '商品售价，精确到分',
    description TEXT COMMENT '商品详细描述',
    stock INT DEFAULT 0 COMMENT '库存数量，默认为0',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '商品创建时间'
) COMMENT '商品信息表';

-- 创建订单表（带字段注释）
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID，自增主键',
    user_id INT NOT NULL COMMENT '下单用户ID，关联users表',
    order_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '下单时间',
    total_amount DECIMAL(10,2) NOT NULL COMMENT '订单总金额，精确到分',
    status TINYINT DEFAULT 1 COMMENT '订单状态：1-待付款，2-已付款，3-已发货，4-已完成'
) COMMENT '订单主表';

-- 创建订单详情表（带字段注释）
CREATE TABLE order_items (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '订单项ID，自增主键',
    order_id INT NOT NULL COMMENT '所属订单ID，关联orders表',
    product_id INT NOT NULL COMMENT '购买商品ID，关联products表',
    quantity INT NOT NULL COMMENT '购买数量',
    price DECIMAL(10,2) NOT NULL COMMENT '购买时的商品单价，精确到分'
) COMMENT '订单详情表';
```

 

## 插入示例数据
```sql
-- 插入用户数据
INSERT INTO users (username, password, email, phone) 
VALUES 
    ('张三', '123456', 'zhangsan@example.com', '13800138001'),
    ('李四', '123456', 'lisi@example.com', '13800138002'),
    ('王五', '123456', 'wangwu@example.com', '13800138003');

-- 插入商品数据
INSERT INTO products (name, price, description, stock) 
VALUES 
    ('iPhone 13', 5999.00, 'Apple最新款手机', 100),
    ('MacBook Pro', 12999.00, '专业级笔记本电脑', 50),
    ('AirPods', 999.00, '无线耳机', 200),
    ('iPad', 3999.00, '平板电脑', 80);

-- 插入订单
INSERT INTO orders (user_id, total_amount, status) 
VALUES (1, 6998.00, 2);

-- 插入订单详情
INSERT INTO order_items (order_id, product_id, quantity, price) 
VALUES 
    (1, 1, 1, 5999.00),
    (1, 3, 1, 999.00);
```

## 查询练习
```sql
-- 查询所有用户信息
SELECT * FROM users;

-- 查询所有价格大于1000的商品
SELECT * FROM products WHERE price > 1000;

-- 查询特定用户的订单
SELECT * FROM orders WHERE user_id = 1;

-- 查询库存低于100的商品
SELECT * FROM products WHERE stock < 100;

-- 查看表结构（包含字段注释）
SHOW FULL COLUMNS FROM users;
SHOW FULL COLUMNS FROM products;
SHOW FULL COLUMNS FROM orders;
SHOW FULL COLUMNS FROM order_items;
```

# 7 知识点
## PRIMARY KEY（主键）
主键是表中的一个特殊字段，用于唯一标识表中的每一行数据。

### 特点：
1. **唯一性**：主键值在表中必须是唯一的，不允许重复
2. **非空性**：主键不允许为NULL
3. **每表一个**：一个表只能有一个主键（可以是单列或多列组合）
4. **索引**：MySQL会自动为主键创建索引，提高查询速度

### 语法：
```sql
-- 单列主键
CREATE TABLE 表名 (
    列名 数据类型 PRIMARY KEY,
    ...
);

-- 或者
CREATE TABLE 表名 (
    列名 数据类型,
    ...,
    PRIMARY KEY (列名)
);

-- 多列组合主键
CREATE TABLE 表名 (
    列名1 数据类型,
    列名2 数据类型,
    ...,
    PRIMARY KEY (列名1, 列名2)
);
```

### 主键的应用场景：
+ 用作表的唯一标识符（如用户ID、订单ID等）
+ 用于表之间的关联关系
+ 需要高效查询的字段

### 示例：
```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID，自增主键',
    username VARCHAR(50) NOT NULL COMMENT '用户名'
);
```

## UNIQUE（唯一约束）
唯一约束确保字段或字段组合的值在表中是唯一的。

### 特点：
1. **唯一性**：**唯一约束字段的值在表中不能重复**
2. **允许NULL**：与主键不同，唯一约束允许NULL值，且可以有多个NULL（MySQL中NULL不等于NULL）
3. **多个约束**：一个表可以有多个唯一约束
4. **索引**：MySQL会自动为**唯一约束创建索引**

### 语法：
```sql
-- 单列唯一约束
CREATE TABLE 表名 (
    列名 数据类型 UNIQUE,
    ...
);

-- 或者
CREATE TABLE 表名 (
    列名 数据类型,
    ...,
    UNIQUE (列名)
);

-- 多列组合唯一约束
CREATE TABLE 表名 (
    列名1 数据类型,
    列名2 数据类型,
    ...,
    UNIQUE (列名1, 列名2)
);
```

### 唯一约束的应用场景：
+ 需要保证唯一性但不作为主键的字段（如用户名、邮箱、手机号）
+ 需要建立唯一索引的字段
+ 业务上不允许重复的字段

### 示例：
```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID，自增主键',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名，唯一，用于登录',
    email VARCHAR(100) UNIQUE COMMENT '用户邮箱，唯一'
);
```

## PRIMARY KEY 与 UNIQUE 的主要区别
1. **NULL值**：
    - PRIMARY KEY 不允许NULL值
    - UNIQUE 允许NULL值，且可以有多个NULL
2. **数量限制**：
    - PRIMARY KEY 每个表只能有一个
    - UNIQUE 每个表可以有多个
3. **用途**：
    - PRIMARY KEY 用于唯一标识一行数据，常用于表关联
    - UNIQUE 用于防止数据重复，但不一定用于表关联
4. **默认索引**：
    - PRIMARY KEY 创建聚集索引(clustered index)
    - UNIQUE 创建非聚集索引(non-clustered index)

在实际应用中，通常使用自增ID作为主键，而将业务字段（如用户名、邮箱等）设置为唯一约束。这样既能保证数据唯一性，又能获得良好的查询性能。



## UNIQUE 约束允许 NULL 值的详细解释
UNIQUE 约束允许 NULL 值是指：在设置了 UNIQUE 约束的列中，可以插入 NULL 值，且可以有多个 NULL 值。这是因为在SQL标准中，NULL 表示"未知"或"不适用"的值，从概念上讲，两个 NULL 值并不相等（NULL ≠ NULL）。

### 详细说明
1. **NULL 的概念**：
    - NULL 不是一个具体的值，而是表示"没有值"或"未知值"
    - 在比较操作中，NULL 与任何值（包括另一个 NULL）的比较结果都不是 TRUE，而是 UNKNOWN
2. **UNIQUE 约束与 NULL**：
    - UNIQUE 约束只保证非 NULL 值的唯一性
    - 一个带有 UNIQUE 约束的列可以包含多个 NULL 值，因为 NULL 不被视为相互相等

### 示例演示
```sql
-- 创建一个带有UNIQUE约束的表
CREATE TABLE test_unique (
    id INT AUTO_INCREMENT PRIMARY KEY,
    code VARCHAR(10) UNIQUE COMMENT '唯一代码'
);

-- 插入NULL值
INSERT INTO test_unique (code) VALUES (NULL);
INSERT INTO test_unique (code) VALUES (NULL);

-- 查看结果
SELECT * FROM test_unique;
```

执行上述SQL后，表中会有两条记录，它们的 code 字段都是 NULL。这证明 UNIQUE 约束允许多个 NULL 值。

### 特别注意
虽然标准SQL允许 UNIQUE 约束的列包含多个 NULL 值，但实际行为可能因数据库系统而异：

1. **MySQL**：允许 UNIQUE 约束列包含多个 NULL 值
2. **SQL Server**：允许 UNIQUE 约束列包含多个 NULL 值
3. **Oracle**：从Oracle 8i开始，默认也允许 UNIQUE 约束列包含多个 NULL 值
4. **PostgreSQL**：允许 UNIQUE 约束列包含多个 NULL 值

### 实际应用示例
在用户表中，如果电子邮件是可选的（可以为NULL），但如果提供了就必须是唯一的：

```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) UNIQUE  -- 可以为NULL，但如果不是NULL就必须唯一
);

-- 以下插入都是合法的
INSERT INTO users (username, email) VALUES ('user1', 'user1@example.com');
INSERT INTO users (username, email) VALUES ('user2', 'user2@example.com');
INSERT INTO users (username, email) VALUES ('user3', NULL);
INSERT INTO users (username, email) VALUES ('user4', NULL);

-- 以下插入会失败，因为违反了唯一约束
INSERT INTO users (username, email) VALUES ('user5', 'user1@example.com');
```

如果你希望某个字段既不允许重复又不允许为NULL，可以同时添加 UNIQUE 和 NOT NULL 约束：

```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE  -- 不允许NULL，且必须唯一
);
```

这样，email 字段就不能为 NULL，也不能重复，达到了类似主键的效果（但不是主键）。



> 更新: 2025-04-23 20:21:00  
> 原文: <https://www.yuque.com/linuxer/gscfv1/zltznxd3olvb6g5l>